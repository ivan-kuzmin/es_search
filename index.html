<!DOCTYPE html>
<html >
<head>
    <meta charset="UTF-8">
    <link href="css/search.css" rel="stylesheet" media="all">
    <link href="css/table.css" rel="stylesheet" media="all">
    <script src="js/jquery.min.js"></script>
    <script src="JSON-to-Table/JSON-to-Table.min.1.0.0.js"></script>
    <script src="elasticsearch-js/elasticsearch.min.js"></script>
    <script src="elasticsearch-js/elasticsearch.jquery.min.js"></script>
</head>
<body>
    <div class="input-wrapper" data-text="">
        <input id="search_input" type="text" placeholder="Searchâ€¦" autocomplete="off">
    </div>
    <p id="my" style="color: white;"></p>
    <script>
        var client = new $.es.Client({
            hosts: 'https://search-cerebro-xg6oa5f4gmcispwqp3kn3p6mta.us-west-2.es.amazonaws.com'
        });

        var input = document.body.children[0];
        input.oninput = function() {
            if ($('input').val() != "")
                search($('input').val());
            else
                $('#my').text('')
        };

        function search(name) {
            name = "*"+name+"*"
            client.search({
                index: 'skoltech',
                type: 'professora',
                body: {
                    query: {
                        query_string: {
                            fields: ["name^3", "lastname^4", "position^2", "center"],
                            query: name
                        }
                    }
                }
            }).then(function (resp) {
                if (resp.hits.total != 0) {
                    $('#my').createTable(resp.hits.hits.map(function(name, i) {
                        delete resp.hits.hits[i]._source.crei
                        resp.hits.hits[i]._source.name += ' ' + resp.hits.hits[i]._source.lastname
                        delete resp.hits.hits[i]._source.lastname
                        return resp.hits.hits[i]._source;
                    }));
                } else {
                    $('#my').text('No results');
                    $('#my').attr('style', 'text-align: center; color: white');
                }
            }, function (err) {
                console.trace(err.message);
            });
        }
    </script>
    <script  src="js/search.js"></script>
</body>
</html>
